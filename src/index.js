import express from 'express';
import { compareGasEstimates } from './comparator.js';

const app = express();
app.use(express.json());

app.post('/compare', async (req, res) => {
    try {
        const { from, to, data } = req.body;
        const txData = {
            from,
            to,
            data,
            value: "0x0"
        };

        const result = await compareGasEstimates(txData);
        res.json(result);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});

// curl -X POST http://localhost:3000/compare \
//                                                     -H "Content-Type: application/json" \
//                                                     -d '{
//                                                   "to": "0x87553B4336be901BF7460213D42f5171fa416750",
//                                                   "data": "0x178a54ab0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000005095edbfcbddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c0000000000000000000000000000000000000000000000000005095edbfcbddd90000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c736ca3d9b1e90af4230bd8f9626528b3d4e0ee0000000000000000000000000bed24d194afe26169a1f4a419e381dd4e99f9c1f0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000bb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c000000000000000000000000c748673057861a797275cd8a068abb95a902e8de0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c748673057861a797275cd8a068abb95a902e8de000000000000000000000000bb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000009c400000000000000000000000000000000000000000000000000000000000007d0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
//                                                   "from": "0x629500fF1Fb1f5511546bF1Cf321a6Eada95C172"
//                                                 }'